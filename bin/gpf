#!/usr/bin/env bash

#
# push force subtree to repo
#

dev_path=rails
repo=''

print_usage() {
  printf "Git push subtree\n\n"
  printf "Options flags as follows:\n"
  printf "  d - development\n"
  printf "  l - local development\n"
  printf "  p - production\n"
  printf "  s - staging\n"
  printf "\n"
  printf "Example: gpf -p \n"
}

print_banner() {
  printf "\n\n"
  printf "  ******************************************\n"
  printf "  *                                        *\n"
  printf "  *           push ${repo} --force      *\n"
  printf "  *                                        *\n"
  printf "  ******************************************\n"
  printf "\n\n"
}

are_you_sure() {
  read -p "Continue (y/n)? " choice
  case "$choice" in
    y|Y ) printf "\nYes. Continuing...\n";;
    n|N ) printf "\nNo. Exiting\n"
          exit 1 ;;
    * ) printf "\nInvalid. Exiting\n"
        exit 1 ;;
  esac
}

while getopts 'dhlLps' flag; do
  case "${flag}" in
    d) printf "push ${dev_path} --force\n"
       repo=development ;;
    l) printf "push ${dev_path} --force\n"
       repo=development.local ;;
    L) printf "push ${dev_path} --force\n"
       repo=production.local ;;
    h) print_usage
       exit 1 ;;
    p) repo=production
       print_banner
       are_you_sure ;;
    s) printf "push ${dev_path} --force\n"
       repo=staging ;;
    *) print_usage
       exit 1;;
  esac
done

if (( $OPTIND == 1 )); then
  print_usage
  exit 1
fi

git push $repo `git subtree split --prefix rails master`:master --force
